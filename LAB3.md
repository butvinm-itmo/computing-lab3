
# Требования к содержанию отчёта
1. Титульный лист, на котором указывается следующая информация:
– название университета;
– название факультета, кафедры;
– название дисциплины;
– номер и тема лабораторной работы;
– вариант задания;
– фамилия, инициалы и номер группы каждого исполнителя;
– фамилия и инициалы преподавателя;
– текущий год.
2. Задание к лабораторной работе в соответствии с вариантом.
3. Описание организации программы и структуры драйверов, блок-схема прикладного
алгоритма.
4. Дополнительные материалы, если они требуются по заданию конкретной
лабораторной работы (руководство по использованию и т. п.).
5. Исходные коды собственной разработки: основная программа, разработанные
драйверы и библиотеки (если есть). Коды из стандартных и сторонних библиотек, а также
созданные генератором STM32CubeMX, приводить не следует. При большом объеме
исходных кодов можно включать только наиболее значимые в данной работе части
(например, не включать код, разработанный для предыдущей лабораторной работы).
Дополнительно, но не вместо исходных кодов, можно привести ссылку на репозиторий с
полной версией проекта.
6. Выводы, сделанные в процессе выполнения лабораторной работы.

# 5.3. Лабораторная работа 3. Таймеры

# Цели работы

1. Получить базовые знания об устройстве и режимах работы таймеров в
   микроконтроллерах.
2. Получить навыки использования таймеров и прерываний от таймеров.
3. Получить навыки использования аппаратных каналов ввода-вывода таймеров.

# Задание

Разработать программу, которая использует таймеры для управления яркостью
светодиодов и излучателем звука (по прерыванию или с использованием аппаратных
каналов). Блокирующее ожидание (функция HAL_Delay()) в программе использоваться не
должно.
Стенд должен поддерживать связь с компьютером по UART и выполнять указанные
действия в качестве реакции на нажатие кнопок на клавиатуре компьютера. В данной
лабораторной работе каждая нажатая кнопка (символ, отправленный с компьютера на стенд)
обрабатываются отдельно, ожидание ввода полной строки не требуется.
Для работы с UART на стенде можно использован один из двух вариантов драйвера (по
прерыванию и по опросу) на выбор исполнителя. Поддержка двух вариантов не требуется.
Частота синхросигнала процессорного ядра и сигнала ШИМ для управления яркостью
светодиодов (если используется) должны соответствовать указанным в варианте задания.

# Порядок выполнения работы

1. Изучить:

- разделы учебного пособия:
  o 1.5. Программируемые таймеры;
- электрическую принципиальную схему стенда в части излучателя звука;
- разделы справочного руководства RM0090:
  o Basic timers (TIM6 and TIM7);
  o General-purpose timers (TIM2 to TIM5);
  o General-purpose timers (TIM9 to TIM14);
  o Advanced-control timers (TIM1 and TIM8);
- состав стандартных драйверов таймеров из библиотеки HAL и содержимое
  создаваемых генератором файлов tim.c/.h (появляются в проекте после настройки
  таймеров в графическом конфигураторе).

2. Подготовить шаблон проекта для STM32CubeIDE, настроить тактовые частоты.
3. Настроить входы и выходы микроконтроллера, таймеры и UART.
4. Разработать необходимые драйверы управляемых светодиодов и/или излучателя
   звука (зависит от варианта). Подготовить формулы для расчета необходимых частот, после
   выполнения работы включить их в отчет с объяснением, как они реализуются в программе.
5. Разработать прикладную программу согласно варианту задания и протестировать ее.

# Варианты заданий

# Вариант 1

Реализовать «музыкальную клавиатуру» с помощью излучателя звука.
Существует девять стандартных октав от субконтроктавы (первая по порядку) до пятой
октавы (девятая по порядку) (более подробно об октавах см. в специализированных
источниках). Частоты нот в соседних октавах отличаются ровно в два раза и растут с
номером октавы. Частоты для первой октавы (пятая по порядку):

| Нота | Частота, Гц |
| ---- | ----------- |
| До   | 261         |
| Ре   | 293         |
| Ми   | 329         |
| Фа   | 349         |
| Соль | 392         |
| Ля   | 440         |
| Си   | 493         |

Стенд должен выполнять следующие действия при получении символов от
компьютера:

| Символ    | Действие                                                                                                                                                              |
| --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| «1» – «7» | Воспроизведение одной ноты (от «до» до «си») текущей октавы с текущей длительностью звучания. Начальные значения: первая октава (пятая по порядку), длительность 1 с. |
| «+»       | Увеличение номера текущей октавы (максимальная – пятая).                                                                                                              |
| «-»       | Уменьшение номера текущей октавы (минимальная – субконтроктава).                                                                                                      |
| «A»       | Увеличение длительности воспроизведения ноты на 0,1 с (максимум – 5 с).                                                                                               |
| «a»       | Уменьшение длительности воспроизведения ноты на 0,1 с (минимум – 0,1 с).                                                                                              |
| «Enter»   | Последовательное воспроизведение всех нот текущей октавы с текущей длительности                                                                                       |

По вводу каждого символа в UART должно выводиться сообщение:

- для символов «1» – «7», «Enter»: какая нота какой октавы и с какой длительностью
  проигрывается;
- для символов настройки: новые значения номера октавы и длительности звучания
  ноты;
- для символов, не перечисленных в таблице выше: сообщение «неверный символ» и
  его код.
  Частота процессорного ядра – 120 МГц.
